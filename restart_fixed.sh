#!/bin/bash

echo "üöÄ –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker compose down

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
echo "üóÑÔ∏è –ó–∞–ø—É—Å–∫–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö..."
docker compose up -d db

# –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã
echo "‚è≥ –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
sleep 10

# –ó–∞–ø—É—Å–∫–∞–µ–º backend —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏
echo "üîß –ó–∞–ø—É—Å–∫–∞–µ–º backend —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏..."
docker compose up -d backend

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ backend
echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ backend..."
sleep 25

# –ü—Ä–æ–≤–µ—Ä—è–µ–º API
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º API..."
if curl -f http://localhost:8000/health > /dev/null 2>&1; then
    echo "‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç"
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏
    echo "ü§ñ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏..."
    docker compose up -d bot
    
    # –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
    echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞..."
    sleep 15
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    echo "üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞..."
    docker compose ps
    
    echo "üéâ –°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏!"
    echo "üì± –ë–æ—Ç: @TrendPulseAI_bot"
    echo "üåê API: http://localhost:8000"
    echo "üìä –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs"
    
else
    echo "‚ùå API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo "üìã –õ–æ–≥–∏ backend:"
    docker compose logs backend --tail=20
fi 