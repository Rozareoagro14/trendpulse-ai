#!/bin/bash

echo "๐ ะััััะพะต ะพะฑะฝะพะฒะปะตะฝะธะต TrendPulse AI..."

# ะัะพะฒะตััะตะผ, ััะพ Docker ะทะฐะฟััะตะฝ
if ! docker info > /dev/null 2>&1; then
    echo "โ Docker ะฝะต ะทะฐะฟััะตะฝ. ะะฐะฟัััะธัะต Docker ะธ ะฟะพะฟัะพะฑัะนัะต ัะฝะพะฒะฐ."
    exit 1
fi

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะบะพะฝัะตะนะฝะตัั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะบะพะฝัะตะนะฝะตัั..."
docker compose down

# ะะตัะตัะพะฑะธัะฐะตะผ ัะพะปัะบะพ ะธะทะผะตะฝะตะฝะฝัะต ะพะฑัะฐะทั
echo "๐จ ะะตัะตัะพะฑะธัะฐะตะผ ะธะทะผะตะฝะตะฝะฝัะต ะพะฑัะฐะทั..."
docker compose build --no-cache

# ะะฐะฟััะบะฐะตะผ ะบะพะฝัะตะนะฝะตัั
echo "โถ๏ธ ะะฐะฟััะบะฐะตะผ ะบะพะฝัะตะนะฝะตัั..."
docker compose up -d

# ะะดะตะผ ะทะฐะฟััะบะฐ
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะธัะพะฒ..."
sleep 10

# ะัะพะฒะตััะตะผ ััะฐััั
echo "๐ ะัะพะฒะตััะตะผ ััะฐััั ัะตัะฒะธัะพะฒ..."
docker compose ps

# ะัะพะฒะตััะตะผ API
echo "๐ ะัะพะฒะตััะตะผ API..."
if curl -f http://localhost:8000/health > /dev/null 2>&1; then
    echo "โ API ัะฐะฑะพัะฐะตั"
else
    echo "โ API ะฝะต ะพัะฒะตัะฐะตั"
fi

# ะะตะฝะตัะธััะตะผ ััะตะฝะฐัะธะธ ะดะปั ะฒัะตั ะฟัะพะตะบัะพะฒ
echo "๐ ะะตะฝะตัะธััะตะผ ััะตะฝะฐัะธะธ ะดะปั ะฒัะตั ะฟัะพะตะบัะพะฒ..."
python generate_all_scenarios.py

echo "๐ ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะฒะตััะตะฝะพ!"
echo "๐ฑ ะะพั: @TrendPulseAI_bot"
echo "๐ API: http://localhost:8000"
echo "๐ ะะพะบัะผะตะฝัะฐัะธั: http://localhost:8000/docs" 