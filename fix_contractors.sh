#!/bin/bash

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö..."

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pip –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if ! command -v pip3 &> /dev/null; then
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pip3..."
    apt update && apt install -y python3-pip
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ httpx
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º httpx..."
pip3 install httpx

# –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–≥–æ)
echo "üßπ –û—á–∏—â–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–∏..."
docker-compose exec db psql -U trendpulse -d trendpulse_db -c "DELETE FROM contractors WHERE id > 1;"

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤
echo "‚ûï –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤..."
python3 add_contractors.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç..."
curl -s "http://localhost:8000/contractors/" | jq '.[] | {id, name, specialization, rating}'

echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üì± –¢–µ–ø–µ—Ä—å –≤ –±–æ—Ç–µ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–∏ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è!" 