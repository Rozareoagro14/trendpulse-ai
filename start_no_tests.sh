#!/bin/bash

echo "๐ ะะฐะฟััะบ ัะธััะตะผั ะฑะตะท ัะตััะพะฒ..."

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะบะพะฝัะตะนะฝะตัั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะบะพะฝัะตะนะฝะตัั..."
docker compose down

# ะะฐะฟััะบะฐะตะผ ัะพะปัะบะพ ะฑะฐะทั ะดะฐะฝะฝัั
echo "๐๏ธ ะะฐะฟััะบะฐะตะผ ะฑะฐะทั ะดะฐะฝะฝัั..."
docker compose up -d db

# ะะดะตะผ ะณะพัะพะฒะฝะพััะธ ะฑะฐะทั
echo "โณ ะะดะตะผ ะณะพัะพะฒะฝะพััะธ ะฑะฐะทั ะดะฐะฝะฝัั..."
sleep 10

# ะะฐะฟััะบะฐะตะผ backend ะฑะตะท ัะตััะพะฒ
echo "๐ง ะะฐะฟััะบะฐะตะผ backend ะฑะตะท ัะตััะพะฒ..."
docker compose run -d --rm backend uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload

# ะะดะตะผ ะทะฐะฟััะบะฐ backend
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ backend..."
sleep 20

# ะัะพะฒะตััะตะผ API
echo "๐ ะัะพะฒะตััะตะผ API..."
if curl -f http://localhost:8000/health > /dev/null 2>&1; then
    echo "โ API ัะฐะฑะพัะฐะตั"
    
    # ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ ะฑะตะท ัะตััะพะฒ
    echo "๐ค ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ ะฑะตะท ัะตััะพะฒ..."
    docker compose run -d --rm bot python3 bot/main.py
    
    # ะะดะตะผ ะทะฐะฟััะบะฐ ะฑะพัะฐ
    echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ะฑะพัะฐ..."
    sleep 10
    
    # ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ
    echo "๐ ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ..."
    docker compose ps
    
    echo "๐ ะกะธััะตะผะฐ ััะฟะตัะฝะพ ะทะฐะฟััะตะฝะฐ ะฑะตะท ัะตััะพะฒ!"
    echo "๐ฑ ะะพั: @TrendPulseAI_bot"
    echo "๐ API: http://localhost:8000"
    echo "๐ ะะพะบัะผะตะฝัะฐัะธั: http://localhost:8000/docs"
    
else
    echo "โ API ะฝะต ัะฐะฑะพัะฐะตั"
    echo "๐ ะะพะณะธ backend:"
    docker compose logs backend --tail=20
fi 